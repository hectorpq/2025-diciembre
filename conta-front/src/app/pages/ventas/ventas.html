<h2 class="titulo">ðŸ›’ Registro de Ventas</h2>

<div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

<!-- CLIENTE -->
<div class="formulario">
  <h3>ðŸ‘¤ Cliente</h3>

  <label>Seleccionar Cliente:</label>
  <select [(ngModel)]="nuevaVenta.clienteId" (change)="onClienteSeleccionado()">
    <option [ngValue]="null">-- Nuevo Cliente --</option>
    <option *ngFor="let c of clientes" [ngValue]="c.id">
      {{ c.nombre }} ({{ c.email }})
    </option>
  </select>

  <label>Nombre:</label>
  <input type="text" [(ngModel)]="nuevaVenta.clienteNombre" [readonly]="nuevaVenta.clienteId != null" />

  <label>Email:</label>
  <input type="email" [(ngModel)]="nuevaVenta.clienteEmail" [readonly]="nuevaVenta.clienteId != null" />

  <label>TelÃ©fono:</label>
  <input type="text" [(ngModel)]="nuevaVenta.clienteTelefono" [readonly]="nuevaVenta.clienteId != null" />
</div>

<!-- PRODUCTO -->
<div class="formulario">
  <h3>ðŸ“¦ Producto</h3>

  <label>Producto:</label>
  <select [(ngModel)]="productoSeleccionado.idProducto">
    <option [ngValue]="null">-- Selecciona --</option>
    <option *ngFor="let p of productos" [ngValue]="p.id">
      {{ p.nombre }} - S/ {{ p.precioUnitario }}
    </option>
  </select>

  <label>Cantidad:</label>
  <input type="number" [(ngModel)]="productoSeleccionado.cantidad" min="1" />

  <label>Descuento (S/):</label>
  <input type="number" [(ngModel)]="productoSeleccionado.descuento" min="0" />

  <button (click)="agregarDetalle()">âž• Agregar Producto</button>
</div>

<!-- DETALLES -->
<table>
  <thead>
  <tr>
    <th>Producto</th>
    <th>Cantidad</th>
    <th>Precio Unitario</th>
    <th>Subtotal</th>
    <th>IGV</th>
    <th>Descuento</th>
    <th>Total</th>
    <th>AcciÃ³n</th>
  </tr>
  </thead>
  <tbody>
  <tr *ngFor="let d of nuevaVenta.detalles; let i = index">
    <td>{{ d.descripcion }}</td>
    <td>{{ d.cantidad }}</td>
    <td>S/ {{ d.precioUnitario }}</td>
    <td>S/ {{ d.subtotal }}</td>
    <td>S/ {{ d.impuesto }}</td>
    <td>S/ {{ d.descuento }}</td>
    <td>S/ {{ d.totalItem }}</td>
    <td><button (click)="eliminarDetalle(i)">ðŸ—‘ Eliminar</button></td>
  </tr>
  </tbody>
</table>

<div class="total">
  ðŸ’° Total Venta: <strong>S/ {{ nuevaVenta.total }}</strong>
</div>

<button class="registrar" (click)="registrarVenta()">ðŸ’¾ Registrar Venta</button>
